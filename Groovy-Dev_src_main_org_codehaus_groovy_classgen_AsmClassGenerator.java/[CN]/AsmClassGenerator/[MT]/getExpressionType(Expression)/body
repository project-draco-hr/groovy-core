{
  if (isComparisonExpression(expression)) {
    return ClassHelper.boolean_TYPE;
  }
  if (expression instanceof VariableExpression) {
    VariableExpression varExpr=(VariableExpression)expression;
    if (varExpr.isThisExpression()) {
      return classNode;
    }
 else     if (varExpr.isSuperExpression()) {
      return classNode.getSuperClass();
    }
    Variable variable=compileStack.getVariable(varExpr.getName(),false);
    if (variable != null && !variable.isHolder()) {
      ClassNode type=variable.getType();
      if (!variable.isDynamicTyped())       return type;
    }
    if (variable == null) {
      org.codehaus.groovy.ast.Variable var=(org.codehaus.groovy.ast.Variable)compileStack.getScope().getReferencedClassVariable(varExpr.getName());
      if (var != null && !var.isDynamicTyped())       return var.getType();
    }
  }
  return expression.getType();
}
