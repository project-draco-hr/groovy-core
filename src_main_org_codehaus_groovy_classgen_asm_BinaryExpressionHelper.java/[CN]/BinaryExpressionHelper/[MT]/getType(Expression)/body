{
  if (controller.isInClosure() && exp instanceof VariableExpression) {
    VariableExpression ve=(VariableExpression)exp;
    org.codehaus.groovy.ast.Variable v=ve.getAccessedVariable();
    if ((v instanceof VariableExpression || v instanceof Parameter) && !ve.isClosureSharedVariable()) {
      return exp.getType();
    }
 else {
      return ClassHelper.OBJECT_TYPE;
    }
  }
  return exp.getType();
}
