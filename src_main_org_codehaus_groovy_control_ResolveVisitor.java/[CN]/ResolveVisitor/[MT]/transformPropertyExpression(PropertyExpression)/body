{
  boolean itlp=isTopLevelProperty;
  boolean ipe=inPropertyExpression;
  Expression objectExpression=pe.getObjectExpression();
  inPropertyExpression=true;
  isTopLevelProperty=(objectExpression.getClass() != PropertyExpression.class);
  objectExpression=transform(objectExpression);
  inPropertyExpression=false;
  Expression property=transform(pe.getProperty());
  isTopLevelProperty=itlp;
  inPropertyExpression=ipe;
  boolean spreadSafe=pe.isSpreadSafe();
  PropertyExpression old=pe;
  pe=new PropertyExpression(objectExpression,property,pe.isSafe());
  pe.setSpreadSafe(spreadSafe);
  pe.setSourcePosition(old);
  String className=lookupClassName(pe);
  if (className != null) {
    ClassNode type=ClassHelper.make(className);
    if (resolve(type)) {
      Expression ret=new ClassExpression(type);
      ret.setSourcePosition(pe);
      return ret;
    }
  }
  if (objectExpression instanceof ClassExpression && pe.getPropertyAsString() != null) {
    ClassExpression ce=(ClassExpression)objectExpression;
    ClassNode type=ClassHelper.make(ce.getType().getName() + "$" + pe.getPropertyAsString());
    if (resolve(type,false,false,false)) {
      Expression ret=new ClassExpression(type);
      ret.setSourcePosition(ce);
      return ret;
    }
  }
  Expression ret=pe;
  if (isTopLevelProperty)   ret=correctClassClassChain(pe);
  return ret;
}
