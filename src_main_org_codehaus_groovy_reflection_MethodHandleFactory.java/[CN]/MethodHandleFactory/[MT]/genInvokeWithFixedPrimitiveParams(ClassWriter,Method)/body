{
  MethodVisitor mv;
  final Class<?>[] pt=method.getParameterTypes();
  final int pc=pt.length;
  if (pc > 0 && pc <= 3) {
    StringBuilder pdescb=new StringBuilder();
    boolean hasPrimitive=false;
    for (int i=0; i != pc; ++i)     if (pt[i].isPrimitive()) {
      hasPrimitive=true;
      pdescb.append(BytecodeHelper.getTypeDescription(pt[i]));
    }
 else     pdescb.append("Ljava/lang/Object;");
    if (!hasPrimitive)     return;
    String pdesc=pdescb.toString();
    mv=cw.visitMethod(Opcodes.ACC_PUBLIC,"invoke","(Ljava/lang/Object;" + pdesc + ")Ljava/lang/Object;",null,EXCEPTIONS);
    mv.visitCode();
    Class callClass=method.getDeclaringClass();
    boolean useInterface=callClass.isInterface();
    String type=BytecodeHelper.getClassInternalName(callClass.getName());
    String descriptor=BytecodeHelper.getMethodDescriptor(method.getReturnType(),method.getParameterTypes());
    if (Modifier.isStatic(method.getModifiers())) {
      MethodHandleFactory.genLoadParametersPrimitiveDirect(2,mv,method);
      mv.visitMethodInsn(Opcodes.INVOKESTATIC,type,method.getName(),descriptor);
    }
 else {
      mv.visitVarInsn(Opcodes.ALOAD,1);
      BytecodeHelper.doCast(mv,callClass);
      MethodHandleFactory.genLoadParametersPrimitiveDirect(2,mv,method);
      mv.visitMethodInsn((useInterface) ? Opcodes.INVOKEINTERFACE : Opcodes.INVOKEVIRTUAL,type,method.getName(),descriptor);
    }
    BytecodeHelper.box(mv,method.getReturnType());
    if (method.getReturnType() == void.class) {
      mv.visitInsn(Opcodes.ACONST_NULL);
    }
    mv.visitInsn(Opcodes.ARETURN);
    mv.visitMaxs(0,0);
    mv.visitEnd();
  }
}
