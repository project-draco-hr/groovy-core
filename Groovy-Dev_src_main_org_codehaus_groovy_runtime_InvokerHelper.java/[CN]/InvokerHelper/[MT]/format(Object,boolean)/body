{
  if (arguments == null) {
    final NullObject nullObject=NullObject.getNullObject();
    return (String)nullObject.getMetaClass().invokeMethod(nullObject,"toString",EMPTY_ARGS);
  }
  if (arguments.getClass().isArray()) {
    return format(DefaultTypeTransformation.asCollection(arguments),verbose);
  }
  if (arguments instanceof Range) {
    Range range=(Range)arguments;
    if (verbose) {
      return range.inspect();
    }
 else {
      return range.toString();
    }
  }
  if (arguments instanceof List) {
    List list=(List)arguments;
    StringBuffer buffer=new StringBuffer("[");
    boolean first=true;
    for (Iterator iter=list.iterator(); iter.hasNext(); ) {
      if (first) {
        first=false;
      }
 else {
        buffer.append(", ");
      }
      buffer.append(format(iter.next(),verbose));
    }
    buffer.append("]");
    return buffer.toString();
  }
  if (arguments instanceof Map) {
    Map map=(Map)arguments;
    if (map.isEmpty()) {
      return "[:]";
    }
    StringBuffer buffer=new StringBuffer("[");
    boolean first=true;
    for (Iterator iter=map.entrySet().iterator(); iter.hasNext(); ) {
      if (first) {
        first=false;
      }
 else {
        buffer.append(", ");
      }
      Map.Entry entry=(Map.Entry)iter.next();
      buffer.append(format(entry.getKey(),verbose));
      buffer.append(":");
      if (entry.getValue() == map) {
        buffer.append("this Map_");
      }
 else {
        buffer.append(format(entry.getValue(),verbose));
      }
    }
    buffer.append("]");
    return buffer.toString();
  }
  if (arguments instanceof Element) {
    return DOMUtil.serialize((Element)arguments);
  }
  if (arguments instanceof String) {
    if (verbose) {
      String arg=((String)arguments).replaceAll("\\n","\\\\n");
      arg=arg.replaceAll("\\r","\\\\r");
      arg=arg.replaceAll("\\t","\\\\t");
      arg=arg.replaceAll("\\f","\\\\f");
      arg=arg.replaceAll("\\\"","\\\\\"");
      arg=arg.replaceAll("\\\\","\\\\");
      return "\"" + arg + "\"";
    }
 else {
      return (String)arguments;
    }
  }
  return arguments.toString();
}
