{
  this.classNode=node;
  if ((classNode.getModifiers() & Opcodes.ACC_INTERFACE) > 0) {
    ConstructorNode dummy=new ConstructorNode(0,null);
    addFieldInitialization(node,dummy);
    node.visitContents(this);
    return;
  }
  addDefaultParameterMethods(node);
  if (!node.isDerivedFromGroovyObject()) {
    node.addInterface(GroovyObject.class.getName());
    StaticMethodCallExpression initMetaClassCall=new StaticMethodCallExpression(Type.makeType(ScriptBytecodeAdapter.class),"getMetaClass",VariableExpression.THIS_EXPRESSION);
    PropertyNode metaClassProperty=node.addProperty("metaClass",ACC_PUBLIC,Type.makeType(MetaClass.class),initMetaClassCall,null,null);
    metaClassProperty.setSynthetic(true);
    FieldNode metaClassField=metaClassProperty.getField();
    metaClassField.setModifiers(metaClassField.getModifiers() | ACC_TRANSIENT);
    FieldExpression metaClassVar=new FieldExpression(metaClassField);
    IfStatement initMetaClassField=new IfStatement(new BooleanExpression(new BinaryExpression(metaClassVar,Token.newSymbol(Types.COMPARE_EQUAL,-1,-1),ConstantExpression.NULL)),new ExpressionStatement(new BinaryExpression(metaClassVar,Token.newSymbol(Types.EQUAL,-1,-1),initMetaClassCall)),EmptyStatement.INSTANCE);
    node.addSyntheticMethod("getMetaClass",ACC_PUBLIC,Type.makeType(MetaClass.class),Parameter.EMPTY_ARRAY,new BlockStatement(new Statement[]{initMetaClassField,new ReturnStatement(metaClassVar)}));
    Type superClass=node.getSuperClass();
    boolean addDelegateObject=(node instanceof InnerClassNode && superClass.equals(Closure.class.getName())) || superClass.equals(Type.GSTRING_TYPE);
    if (!addDelegateObject) {
      node.addSyntheticMethod("invokeMethod",ACC_PUBLIC,Type.OBJECT_TYPE,new Parameter[]{new Parameter(Type.makeType(String.class),"method"),new Parameter(Type.OBJECT_TYPE,"arguments")},new BlockStatement(new Statement[]{initMetaClassField,new ReturnStatement(new MethodCallExpression(metaClassVar,"invokeMethod",new ArgumentListExpression(new Expression[]{VariableExpression.THIS_EXPRESSION,new VariableExpression("method"),new VariableExpression("arguments")})))}));
      node.addSyntheticMethod("invokeMethodAt",ACC_PUBLIC,Type.OBJECT_TYPE,new Parameter[]{new Parameter(Type.makeType(Class.class),"at"),new Parameter(Type.makeType(String.class),"method2"),new Parameter(Type.OBJECT_TYPE,"arguments2")},new BlockStatement(new Statement[]{initMetaClassField,new ReturnStatement(new MethodCallExpression(metaClassVar,"invokeMethodAt",new ArgumentListExpression(new Expression[]{VariableExpression.THIS_EXPRESSION,new VariableExpression("at"),new VariableExpression("method2"),new VariableExpression("arguments2")})))}));
      if (!node.isScript()) {
        node.addSyntheticMethod("getProperty",ACC_PUBLIC,Type.OBJECT_TYPE,new Parameter[]{new Parameter(Type.makeType(String.class),"property")},new BlockStatement(new Statement[]{initMetaClassField,new ReturnStatement(new MethodCallExpression(metaClassVar,"getProperty",new ArgumentListExpression(new Expression[]{VariableExpression.THIS_EXPRESSION,new VariableExpression("property")})))}));
        node.addSyntheticMethod("setProperty",ACC_PUBLIC,Type.VOID_TYPE,new Parameter[]{new Parameter(Type.makeType(String.class),"property"),new Parameter(Type.OBJECT_TYPE,"value")},new BlockStatement(new Statement[]{initMetaClassField,new ExpressionStatement(new MethodCallExpression(metaClassVar,"setProperty",new ArgumentListExpression(new Expression[]{VariableExpression.THIS_EXPRESSION,new VariableExpression("property"),new VariableExpression("value")})))}));
      }
    }
  }
  if (node.getDeclaredConstructors().isEmpty()) {
    ConstructorNode constructor=new ConstructorNode(ACC_PUBLIC,null);
    constructor.setSynthetic(true);
    node.addConstructor(constructor);
  }
  if (!(node instanceof InnerClassNode)) {
    FieldNode timeTagField=new FieldNode(Verifier.__TIMESTAMP,Modifier.PUBLIC | Modifier.STATIC,Type.makeType(Long.class),node.getType(),new ConstantExpression(new Long(System.currentTimeMillis())));
    timeTagField.setSynthetic(true);
    node.addField(timeTagField);
  }
  addFieldInitialization(node);
  node.visitContents(this);
}
