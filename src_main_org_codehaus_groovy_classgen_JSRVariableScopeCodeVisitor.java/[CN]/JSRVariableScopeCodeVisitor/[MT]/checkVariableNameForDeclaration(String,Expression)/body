{
  if (expression == VariableExpression.THIS_EXPRESSION)   return;
  if ("super".equals(name))   return;
  VariableScope scope=currentScope;
  while (scope != null) {
    if (scope.getDeclaredVariables().contains(name))     break;
    if (scope.getReferencedVariables().contains(name))     break;
    scope=scope.getParent();
  }
  VariableScope end=scope;
  if (scope == null) {
    declare(name,expression);
    addError("The variable " + name + " is undefined in the current scope",expression);
  }
 else {
    scope=currentScope;
    while (scope != end) {
      scope.getReferencedVariables().add(name);
      scope=scope.getParent();
    }
  }
}
