{
  if (this.replacementNodeStack.empty()) {
    final Iterator iter=this.children.iterator();
    while (iter.hasNext()) {
      final Object child=iter.next();
      if (child instanceof Writable) {
        ((Writable)child).writeTo(out);
      }
 else {
        out.write(child.toString());
      }
    }
    return out;
  }
 else {
    return ((Writable)this.replacementNodeStack.peek()).writeTo(out);
  }
}
