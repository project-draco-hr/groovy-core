{
  Map<VariableExpression,List<ClassNode>> oldTracker=pushAssignmentTracking();
  typeCheckingContext.pushTemporaryTypeInfo();
  expression.getBooleanExpression().visit(this);
  Expression trueExpression=expression.getTrueExpression();
  Expression falseExpression=expression.getFalseExpression();
  trueExpression.visit(this);
  typeCheckingContext.popTemporaryTypeInfo();
  falseExpression.visit(this);
  ClassNode resultType=OBJECT_TYPE;
  if (isNullConstant(trueExpression) || isNullConstant(falseExpression)) {
    BinaryExpression enclosingBinaryExpression=typeCheckingContext.getEnclosingBinaryExpression();
    if (enclosingBinaryExpression != null) {
      resultType=getType(enclosingBinaryExpression.getLeftExpression());
    }
  }
 else {
    final ClassNode typeOfTrue=getType(trueExpression);
    final ClassNode typeOfFalse=getType(falseExpression);
    resultType=lowestUpperBound(typeOfTrue,typeOfFalse);
  }
  storeType(expression,resultType);
  popAssignmentTracking(oldTracker);
}
