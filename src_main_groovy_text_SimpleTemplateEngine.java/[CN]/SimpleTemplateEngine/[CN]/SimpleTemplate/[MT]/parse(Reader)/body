{
  if (!reader.markSupported()) {
    reader=new BufferedReader(reader);
  }
  StringWriter sw=new StringWriter();
  startScript(sw);
  boolean start=false;
  int c;
  while ((c=reader.read()) != -1) {
    if (c == '<') {
      c=reader.read();
      if (c != '%') {
        sw.write('<');
      }
 else {
        reader.mark(1);
        c=reader.read();
        if (c == '=') {
          groovyExpression(reader,sw);
        }
 else {
          reader.reset();
          groovySection(reader,sw);
        }
        continue;
      }
    }
    if (c == '\"') {
      sw.write('\\');
    }
    sw.write(c);
  }
  endScript(sw);
  String result=sw.toString();
  System.out.println("source text:\n" + result);
  return result;
}
