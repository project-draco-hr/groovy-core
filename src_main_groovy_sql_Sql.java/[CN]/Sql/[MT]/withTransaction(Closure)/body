{
  boolean savedCacheConnection=cacheConnection;
  cacheConnection=true;
  Connection connection=null;
  try {
    connection=createConnection();
    connection.setAutoCommit(false);
    if (closure.getMaximumNumberOfParameters() == 1) {
      closure.call(connection);
    }
 else {
      closure.call();
    }
    System.out.println("pre connection.dump() = " + DefaultGroovyMethods.dump(connection));
    connection.commit();
  }
 catch (  SQLException e) {
    log.log(Level.INFO,"Rolling back due to exception: " + e,e);
    System.out.println("post connection.dump() = " + DefaultGroovyMethods.dump(connection));
    if (connection != null)     connection.rollback();
    throw e;
  }
 finally {
    if (connection != null)     connection.setAutoCommit(true);
    cacheConnection=savedCacheConnection;
    closeResources(connection,null);
  }
}
