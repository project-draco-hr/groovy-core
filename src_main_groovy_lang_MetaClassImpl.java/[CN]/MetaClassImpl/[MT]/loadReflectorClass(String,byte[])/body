{
  ClassLoader loader=(ClassLoader)AccessController.doPrivileged(new PrivilegedAction(){
    public Object run(){
      return theClass.getClassLoader();
    }
  }
);
  if (loader instanceof GroovyClassLoader) {
    final GroovyClassLoader gloader=(GroovyClassLoader)loader;
    return (Class)AccessController.doPrivileged(new PrivilegedAction(){
      public Object run(){
        return gloader.defineClass(name,bytecode,getClass().getProtectionDomain());
      }
    }
);
  }
  return registry.loadClass(loader,name,bytecode);
}
