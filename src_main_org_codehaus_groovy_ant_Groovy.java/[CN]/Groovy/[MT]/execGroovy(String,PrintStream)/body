{
  log.debug("execGroovy()");
  if ("".equals(txt.trim())) {
    return;
  }
  log.verbose("Groovy: " + txt);
  Object mavenPom=null;
  final Project project=getProject();
  final ClassLoader baseClassLoader;
  if ("org.apache.commons.grant.GrantProject".equals(project.getClass().getName())) {
    try {
      final Object propsHandler=project.getClass().getMethod("getPropsHandler",new Class[0]).invoke(project,new Object[0]);
      final Field contextField=propsHandler.getClass().getDeclaredField("context");
      contextField.setAccessible(true);
      final Object context=contextField.get(propsHandler);
      mavenPom=InvokerHelper.invokeMethod(context,"getProject",new Object[0]);
    }
 catch (    Exception e) {
      throw new BuildException("Impossible to retrieve Maven's Ant project: " + e.getMessage(),getLocation());
    }
    Thread.currentThread().setContextClassLoader(GroovyShell.class.getClassLoader());
    baseClassLoader=mavenPom.getClass().getClassLoader();
  }
 else {
    baseClassLoader=GroovyShell.class.getClassLoader();
  }
  final GroovyClassLoader classLoader=new GroovyClassLoader(baseClassLoader);
  addClassPathes(classLoader);
  final GroovyShell groovy=new GroovyShell(classLoader,new Binding(),configuration);
  try {
    final Script script=groovy.parse(txt);
    script.setProperty("ant",new AntBuilder(this));
    script.setProperty("project",project);
    script.setProperty("properties",new AntProjectPropertiesDelegate(project));
    script.setProperty("target",getOwningTarget());
    script.setProperty("task",this);
    if (mavenPom != null) {
      script.setProperty("pom",mavenPom);
    }
    script.run();
  }
 catch (  CompilationFailedException e) {
    StringWriter writer=new StringWriter();
    new ErrorReporter(e,false).write(new PrintWriter(writer));
    String message=writer.toString();
    throw new BuildException("Script Failed: " + message,getLocation());
  }
}
