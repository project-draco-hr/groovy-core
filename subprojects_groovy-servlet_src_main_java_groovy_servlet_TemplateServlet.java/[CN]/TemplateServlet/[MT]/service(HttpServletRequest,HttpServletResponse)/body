{
  if (verbose) {
    log("Creating/getting cached template...");
  }
  File file=super.getScriptUriAsFile(request);
  String name=file.getName();
  if (!file.exists()) {
    response.sendError(HttpServletResponse.SC_NOT_FOUND);
    return;
  }
  if (!file.canRead()) {
    response.sendError(HttpServletResponse.SC_FORBIDDEN,"Can not read \"" + name + "\"!");
    return;
  }
  long getMillis=System.currentTimeMillis();
  Template template=getTemplate(file);
  getMillis=System.currentTimeMillis() - getMillis;
  ServletBinding binding=new ServletBinding(request,response,servletContext);
  setVariables(binding);
  response.setContentType(CONTENT_TYPE_TEXT_HTML + "; charset=" + encoding);
  response.setStatus(HttpServletResponse.SC_OK);
  Writer out=(Writer)binding.getVariable("out");
  if (out == null) {
    out=response.getWriter();
  }
  if (verbose) {
    log("Making template \"" + name + "\"...");
  }
  long makeMillis=System.currentTimeMillis();
  template.make(binding.getVariables()).writeTo(out);
  makeMillis=System.currentTimeMillis() - makeMillis;
  if (generateBy) {
    StringBuffer sb=new StringBuffer(100);
    sb.append("\n<!-- Generated by Groovy TemplateServlet [create/get=");
    sb.append(Long.toString(getMillis));
    sb.append(" ms, make=");
    sb.append(Long.toString(makeMillis));
    sb.append(" ms] -->\n");
    out.write(sb.toString());
  }
  response.flushBuffer();
  if (verbose) {
    log("Template \"" + name + "\" request responded. [create/get="+ getMillis+ " ms, make="+ makeMillis+ " ms]");
  }
}
