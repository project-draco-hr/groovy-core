{
  if (type.isGenericsPlaceHolder()) {
    String name=type.getGenericsTypes()[0].getName();
    type=(ClassNode)genericsSpec.get(name);
  }
  if (type == null)   type=ClassHelper.OBJECT_TYPE;
  GenericsType[] oldgTypes=type.getGenericsTypes();
  GenericsType[] newgTypes=new GenericsType[0];
  if (oldgTypes != null) {
    newgTypes=new GenericsType[oldgTypes.length];
    for (int i=0; i < newgTypes.length; i++) {
      GenericsType oldgType=oldgTypes[i];
      if (oldgType.isWildcard()) {
        ClassNode oldLower=oldgType.getLowerBound();
        ClassNode lower=oldLower != null ? correctToGenericsSpecRecurse(genericsSpec,oldLower) : null;
        ClassNode[] oldUpper=oldgType.getUpperBounds();
        ClassNode[] upper=null;
        if (oldUpper != null) {
          upper=new ClassNode[oldUpper.length];
          for (int j=0; j < oldUpper.length; j++) {
            upper[j]=correctToGenericsSpecRecurse(genericsSpec,oldUpper[j]);
          }
        }
        GenericsType fixed=new GenericsType(oldgType.getType(),upper,lower);
        fixed.setWildcard(true);
        newgTypes[i]=fixed;
      }
 else {
        newgTypes[i]=new GenericsType(Verifier.correctToGenericsSpec(genericsSpec,oldgType));
      }
    }
  }
  return makeClassSafeWithGenerics(type,newgTypes);
}
