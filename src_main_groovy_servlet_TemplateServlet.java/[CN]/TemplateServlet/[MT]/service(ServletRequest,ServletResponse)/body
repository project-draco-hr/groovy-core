{
  HttpServletRequest httpRequest=(HttpServletRequest)request;
  HttpServletResponse httpResponse=(HttpServletResponse)response;
  String uri=httpRequest.getRequestURI();
  URL url=getClass().getResource(uri);
  if (url == null) {
    url=servletContext.getResource(uri);
    if (url == null) {
      url=ClassLoader.getSystemResource(uri);
    }
  }
  if (url == null) {
    servletContext.log("Resource uri=\"" + uri + "\" not locatable.");
    httpResponse.sendError(404);
    return;
  }
  httpResponse.setContentType("text/html");
  PrintWriter out=httpResponse.getWriter();
  Map binding=new HashMap();
  binding.put("request",httpRequest);
  binding.put("response",httpResponse);
  binding.put("application",servletContext);
  binding.put("session",httpRequest.getSession(true));
  binding.put("out",out);
  Enumeration parameterNames=request.getParameterNames();
  while (parameterNames.hasMoreElements()) {
    Object key=parameterNames.nextElement();
    if (binding.containsKey(key)) {
      servletContext.log("Key \"" + key + "\" already bound.");
    }
 else {
      String[] values=request.getParameterValues((String)key);
      if (values.length == 1) {
        binding.put(key,values[0]);
      }
 else {
        binding.put(key,values);
      }
    }
  }
  try {
    Template template=templateEngine.createTemplate(url);
    template.setBinding(binding);
    template.writeTo(out);
  }
 catch (  FileNotFoundException e) {
    httpResponse.sendError(404,e.getMessage());
  }
catch (  SyntaxException e) {
    httpResponse.sendError(500,e.getMessage());
  }
catch (  ClassNotFoundException e) {
    httpResponse.sendError(500,e.getMessage());
  }
catch (  IOException e) {
    httpResponse.sendError(500,e.getMessage());
  }
}
