{
  Binding binding=new Binding();
  if (bindDefaultVariables) {
    binding.setVariable("request",request);
    binding.setVariable("response",response);
    binding.setVariable("context",servletContext);
    binding.setVariable("session",request.getSession(true));
    binding.setVariable("out",response.getWriter());
  }
  if (bindRequestParameters) {
    Enumeration parameterNames=request.getParameterNames();
    while (parameterNames.hasMoreElements()) {
      String key=(String)parameterNames.nextElement();
      if (binding.getVariables().containsKey(key)) {
        servletContext.log("Key \"" + key + "\" already bound.");
        continue;
      }
      String[] values=request.getParameterValues(key);
      if (values.length == 1) {
        binding.setVariable(key,values[0]);
      }
 else {
        binding.setVariable(key,values);
      }
    }
  }
  return binding;
}
