{
  if (VERBOSE) {
    log("Creating/getting cached template...");
  }
  File file=extractAbsoluteFile(request);
  if (!file.exists()) {
    response.sendError(HttpServletResponse.SC_NOT_FOUND);
    return;
  }
  if (!file.canRead()) {
    response.sendError(HttpServletResponse.SC_FORBIDDEN,"Can not read!");
    return;
  }
  long getMillis=System.currentTimeMillis();
  Template template=getTemplate(file);
  getMillis=System.currentTimeMillis() - getMillis;
  ServletBinding binding=new ServletBinding(request,response,context);
  setVariables(binding);
  response.setContentType(CONTENT_TYPE);
  Writer out=(Writer)binding.getVariable("out");
  if (out == null) {
    out=response.getWriter();
  }
  if (VERBOSE) {
    log("Making template...");
  }
  long makeMillis=System.currentTimeMillis();
  template.make(binding.getVariables()).writeTo(out);
  makeMillis=System.currentTimeMillis() - makeMillis;
  if (generatedBy) {
    out.append("\n<!-- Generated by Groovy TemplateServlet [create/get=");
    out.append(Long.toString(getMillis));
    out.append(" ms, make=");
    out.append(Long.toString(makeMillis));
    out.append(" ms] -->\n");
  }
  response.setStatus(HttpServletResponse.SC_OK);
  response.flushBuffer();
  if (VERBOSE) {
    log("Template request responded. [create/get=" + getMillis + " ms, make="+ makeMillis+ " ms]");
  }
}
