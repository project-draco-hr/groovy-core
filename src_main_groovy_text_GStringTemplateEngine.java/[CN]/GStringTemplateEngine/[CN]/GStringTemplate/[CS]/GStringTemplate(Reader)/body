{
  final StringBuffer templateExpressions=new StringBuffer("package groovy.tmp.templates\n def getTemplate() { return { out -> out << \"\"\"");
  boolean writingString=true;
  while (true) {
    int c=reader.read();
    if (c == -1)     break;
    if (c == '<') {
      c=reader.read();
      if (c == '%') {
        c=reader.read();
        if (c == '=') {
          parseExpression(reader,writingString,templateExpressions);
          writingString=true;
          continue;
        }
 else {
          parseSection(reader,writingString,templateExpressions);
          writingString=false;
          continue;
        }
      }
 else {
        appendCharacter('<',templateExpressions,writingString);
        writingString=true;
      }
    }
 else     if (c == '"') {
      appendCharacter('\\',templateExpressions,writingString);
      writingString=true;
    }
    appendCharacter((char)c,templateExpressions,writingString);
    writingString=true;
  }
  if (writingString) {
    templateExpressions.append("\"\"\"");
  }
  templateExpressions.append("}.asWritable()}");
  final ClassLoader parentLoader=getClass().getClassLoader();
  final GroovyClassLoader loader=(GroovyClassLoader)AccessController.doPrivileged(new PrivilegedAction(){
    public Object run(){
      return new GroovyClassLoader(parentLoader);
    }
  }
);
  final Class groovyClass=loader.parseClass(new GroovyCodeSource(templateExpressions.toString(),"C","x"));
  try {
    final GroovyObject object=(GroovyObject)groovyClass.newInstance();
    this.template=(Closure)object.invokeMethodAt(this.getClass(),"getTemplate",null);
  }
 catch (  InstantiationException e) {
    throw new ClassNotFoundException(e.getMessage());
  }
catch (  IllegalAccessException e) {
    throw new ClassNotFoundException(e.getMessage());
  }
}
