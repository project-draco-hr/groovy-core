{
synchronized (writeLock) {
    waitForWriteState();
    removeDereferencedEntries();
    int hash=key.hashCode();
    int index=index(hash,table.length);
    Entry current=table[index];
    Entry prev=null;
    while (current != null) {
      if (hash == current.hash) {
        Object oldKey=current.getKey();
        if (!current.isValid()) {
          current=current.invalidate();
          if (prev != null) {
            prev.next=current;
          }
 else {
            table[index]=current;
          }
          size--;
          continue;
        }
        if (key == oldKey || key.equals(oldKey)) {
          current=current.invalidate();
          if (prev != null) {
            prev.next=current;
          }
 else {
            table[index]=current;
          }
          size--;
          return;
        }
      }
      prev=current;
      current=current.next;
    }
  }
}
