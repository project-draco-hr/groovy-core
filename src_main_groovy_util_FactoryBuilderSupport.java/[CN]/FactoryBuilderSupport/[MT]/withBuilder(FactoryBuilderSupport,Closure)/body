{
  if (builder == null || closure == null) {
    return null;
  }
  Object result=null;
  Object previousContext=proxyBuilder.getContext();
  FactoryBuilderSupport previousProxyBuilder=proxyBuilder;
  try {
    proxyBuilder=builder;
    closure.setDelegate(builder);
    result=closure.call();
  }
 catch (  RuntimeException e) {
    proxyBuilder=previousProxyBuilder;
    if (proxyBuilder.contexts.contains(previousContext)) {
      Map<String,Object> context=proxyBuilder.getContext();
      while (context != null && context != previousContext) {
        proxyBuilder.popContext();
        context=proxyBuilder.getContext();
      }
    }
    throw e;
  }
 finally {
    proxyBuilder=previousProxyBuilder;
  }
  return result;
}
