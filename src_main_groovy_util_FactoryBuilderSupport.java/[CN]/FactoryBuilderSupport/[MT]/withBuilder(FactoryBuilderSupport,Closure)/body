{
  if (builder == null || closure == null) {
    return null;
  }
  Object result=null;
  Object previousContext=getProxyBuilder().getContext();
  FactoryBuilderSupport previousProxyBuilder=_localProxyBuilder.get();
  try {
    _localProxyBuilder.set(builder);
    closure.setDelegate(builder);
    result=closure.call();
  }
 catch (  RuntimeException e) {
    _localProxyBuilder.set(previousProxyBuilder);
    if (getProxyBuilder().getContexts().contains(previousContext)) {
      Map<String,Object> context=getProxyBuilder().getContext();
      while (context != null && context != previousContext) {
        getProxyBuilder().popContext();
        context=getProxyBuilder().getContext();
      }
    }
    throw e;
  }
 finally {
    _localProxyBuilder.set(previousProxyBuilder);
  }
  return result;
}
