{
  Node root=null;
  try {
    root=xmlParser.parse(reader);
  }
 catch (  SAXException e) {
    throw new RuntimeException("Parsing XML source failed.",e);
  }
  if (root == null) {
    throw new IOException("Parsing XML source failed: root node is null.");
  }
  StringWriter writer=new StringWriter(1024);
  writer.write("/* Generated by XmlTemplateEngine */\n");
  new GspPrinter(new PrintWriter(writer),DEFAULT_INDENTION).print(root);
  String scriptText=writer.toString();
  Script script=groovyShell.parse(scriptText);
  Template template=new XmlTemplate(script);
  return template;
}
