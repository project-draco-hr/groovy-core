{
  Class theClass=obj.getClass();
  final ClassInfo info=ClassInfo.getClassInfo(theClass);
  info.lock();
  try {
    final MetaClass instanceMetaClass=info.getPerInstanceMetaClass(obj);
    if (instanceMetaClass != null)     return instanceMetaClass;
    return getMetaClassUnderLock(theClass,info);
  }
  finally {
    info.unlock();
  }
}
