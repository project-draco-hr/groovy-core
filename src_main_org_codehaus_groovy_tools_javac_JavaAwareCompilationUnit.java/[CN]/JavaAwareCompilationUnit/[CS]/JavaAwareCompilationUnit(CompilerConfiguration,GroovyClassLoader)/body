{
  super(configuration,null,groovyClassLoader);
  javaSources=new LinkedList();
  generationGoal=(File)configuration.getJointCompilationOptions().get("stubDir");
  stubGenerator=new JavaStubGenerator(generationGoal,true,true);
  addPhaseOperation(new PrimaryClassNodeOperation(){
    public void call(    SourceUnit source,    GeneratorContext context,    ClassNode node) throws CompilationFailedException {
      if (javaSources.size() != 0)       new JavaAwareResolveVisitor(JavaAwareCompilationUnit.this).startResolving(node,source);
    }
  }
,Phases.CONVERSION);
  addPhaseOperation(new PrimaryClassNodeOperation(){
    public void call(    SourceUnit source,    GeneratorContext context,    ClassNode classNode) throws CompilationFailedException {
      try {
        if (javaSources.size() != 0)         stubGenerator.generateClass(classNode);
      }
 catch (      FileNotFoundException fnfe) {
        source.addException(fnfe);
      }
    }
  }
,Phases.CONVERSION);
}
