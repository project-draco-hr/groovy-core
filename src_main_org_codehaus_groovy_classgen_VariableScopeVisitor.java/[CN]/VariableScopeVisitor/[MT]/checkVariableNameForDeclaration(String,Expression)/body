{
  if ("super".equals(name) || "this".equals(name))   return null;
  VariableScope scope=currentScope;
  Variable var=new DynamicVariable(name,currentScope.isInStaticContext());
  while (true) {
    Variable var1;
    var1=scope.getDeclaredVariable(var.getName());
    if (var1 != null) {
      var=var1;
      break;
    }
    var1=scope.getReferencedLocalVariable(var.getName());
    if (var1 != null) {
      var=var1;
      break;
    }
    var1=scope.getReferencedClassVariable(var.getName());
    if (var1 != null) {
      var=var1;
      break;
    }
    ClassNode classScope=scope.getClassScope();
    if (classScope != null) {
      Variable member=findClassMember(classScope,var.getName());
      if (member != null) {
        boolean staticScope=currentScope.isInStaticContext() || isSpecialConstructorCall;
        boolean staticMember=member.isInStaticContext();
        if (!(staticScope && !staticMember))         var=member;
      }
      break;
    }
    scope=scope.getParent();
  }
  VariableScope end=scope;
  scope=currentScope;
  while (scope != end) {
    if (end.isClassScope() || (end.isReferencedClassVariable(name) && end.getDeclaredVariable(name) == null)) {
      scope.putReferencedClassVariable(var);
    }
 else {
      var.setClosureSharedVariable(var.isClosureSharedVariable() || inClosure);
      scope.putReferencedLocalVariable(var);
    }
    scope=scope.getParent();
  }
  if (end.isResolvingDynamic()) {
    if (end.getDeclaredVariable(var.getName()) == null) {
      end.putDeclaredVariable(var);
    }
  }
  return var;
}
