{
  Iterator iter=elements.iterator();
  while (iter.hasNext()) {
    Object element=iter.next();
    if (element instanceof Collection) {
      flatten((Collection)element,addTo);
    }
 else     if (element instanceof Map) {
      flatten(((Map)element).values(),addTo);
    }
 else {
      addTo.add(element);
    }
  }
  return addTo;
}
