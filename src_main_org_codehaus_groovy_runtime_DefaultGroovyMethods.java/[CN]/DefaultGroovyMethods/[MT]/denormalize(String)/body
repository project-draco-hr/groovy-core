{
  if (lineSeparator == null) {
    final StringWriter sw=new StringWriter(2);
    try {
      final BufferedWriter bw=new BufferedWriter(sw);
      bw.newLine();
      bw.flush();
      lineSeparator=sw.toString();
    }
 catch (    IOException ioe) {
      lineSeparator="\n";
    }
  }
  final int len=self.length();
  final StringBuilder sb=new StringBuilder((110 * len) / 100);
  char chLookBack='\0';
  for (int i=0; i < len; i++) {
    final char ch=self.charAt(i);
switch (ch) {
case '\r':
      sb.append(lineSeparator);
    break;
case '\n':
  if (chLookBack != '\r')   sb.append(lineSeparator);
break;
default :
sb.append(ch);
break;
}
chLookBack=ch;
}
return sb.toString();
}
