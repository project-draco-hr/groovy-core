{
  Expression leftExpression=expression.getLeftExpression();
  if (leftExpression instanceof BinaryExpression) {
    BinaryExpression leftBinExpr=(BinaryExpression)leftExpression;
    if (leftBinExpr.getOperation().getType() == Types.LEFT_SQUARE_BRACKET) {
      final Expression right=expression.getRightExpression();
      visitAndAutoboxBoolean(right);
      final int rhsVar=compileStack.defineTemporaryVariable("$rhs",right.getType(),true);
      Expression rhsExpr=new BytecodeExpression(){
        public void visit(        MethodVisitor mv){
          mv.visitVarInsn(ALOAD,rhsVar);
        }
      }
;
      visitMethodCallExpression(new MethodCallExpression(leftBinExpr.getLeftExpression(),"putAt",new ArgumentListExpression(new Expression[]{leftBinExpr.getRightExpression(),rhsExpr})));
      mv.visitInsn(POP);
      mv.visitVarInsn(ALOAD,rhsVar);
      compileStack.removeVar(rhsVar);
      return;
    }
  }
  Expression rightExpression=expression.getRightExpression();
  ClassNode type=getLHSType(leftExpression);
  if (ClassHelper.isPrimitiveType(type)) {
    visitAndAutoboxBoolean(rightExpression);
  }
 else   if (!rightExpression.getType().isDerivedFrom(type)) {
    visitCastExpression(new CastExpression(type,rightExpression));
  }
 else {
    visitAndAutoboxBoolean(rightExpression);
  }
  mv.visitInsn(DUP);
  leftHandExpression=true;
  rightHandType=rightExpression.getType();
  leftExpression.visit(this);
  rightHandType=null;
  leftHandExpression=false;
}
