{
  if (type != null) {
    if (type.length() == 0) {
      return "java.lang.Object";
    }
    if (type.endsWith("[]")) {
      String postfix="[]";
      String prefix=type.substring(0,type.length() - 2);
      return checkValidType(prefix,node,message) + postfix;
    }
    int idx=type.indexOf('$');
    if (idx > 0) {
      String postfix=type.substring(idx);
      String prefix=type.substring(0,idx);
      return checkValidType(prefix,node,message) + postfix;
    }
    if (BytecodeHelper.isPrimitiveType(type) || "void".equals(type)) {
      return type;
    }
  }
  String original=type;
  type=resolveClassName(type);
  if (type != null) {
    return type;
  }
  throw new MissingClassException(original,node,message + " for class: " + classNode.getName());
}
