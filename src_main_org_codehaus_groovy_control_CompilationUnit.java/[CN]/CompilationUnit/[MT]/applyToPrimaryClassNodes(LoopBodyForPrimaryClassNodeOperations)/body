{
  boolean failures=false;
  Iterator modules=this.ast.getModules().iterator();
  while (modules.hasNext()) {
    ModuleNode module=(ModuleNode)modules.next();
    try {
      Iterator classNodes=module.getClasses().iterator();
      while (classNodes.hasNext()) {
        ClassNode classNode=(ClassNode)classNodes.next();
        SourceUnit context=module.getContext();
        if (context == null || context.phase <= phase) {
          body.call(module.getContext(),new GeneratorContext(this.ast),classNode);
        }
      }
    }
 catch (    CompilationFailedException e) {
      failures=true;
    }
catch (    Exception e) {
      failures=true;
      addError(new ExceptionMessage(e));
    }
  }
  if (failures) {
    fail();
  }
}
