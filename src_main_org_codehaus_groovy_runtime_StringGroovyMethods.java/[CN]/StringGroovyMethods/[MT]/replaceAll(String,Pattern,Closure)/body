{
  final Matcher matcher=pattern.matcher(self);
  if (matcher.find()) {
    final StringBuffer sb=new StringBuffer(self.length() + 16);
    do {
      String replacement=getReplacement(matcher,closure);
      matcher.appendReplacement(sb,Matcher.quoteReplacement(replacement));
    }
 while (matcher.find());
    matcher.appendTail(sb);
    return sb.toString();
  }
 else {
    return self;
  }
}
