{
  final ClassInfo info=ClassInfo.getClassInfo(theClass);
  MetaClass answer=info.getStrongMetaClass();
  if (answer != null)   return answer;
  answer=info.getWeakMetaClass();
  if (answer != null)   return answer;
  info.lock();
  try {
    answer=info.getStrongMetaClass();
    if (answer != null)     return answer;
    answer=info.getWeakMetaClass();
    if (answer != null)     return answer;
    answer=metaClassCreationHandle.create(theClass,this);
    answer.initialize();
    if (GroovySystem.isKeepJavaMetaClasses()) {
      info.setStrongMetaClass(answer);
    }
 else {
      info.setWeakMetaClass(answer);
    }
    final CachedClass aClass=info.getCachedClass(theClass);
    aClass.setStaticMetaClassField(answer);
    aClass.setMetaClassForClass(answer,true);
    return answer;
  }
  finally {
    info.unlock();
  }
}
