{
  if (groovyLoader == null || groovyLoader.getParent() != parentClassLoader) {
    groovyLoader=(GroovyClassLoader)AccessController.doPrivileged(new PrivilegedAction(){
      public Object run(){
        return new GroovyClassLoader(parentClassLoader){
          protected Class findClass(          String className) throws ClassNotFoundException {
            String filename=className.replace('.',File.separatorChar) + ".groovy";
            URLConnection dependentScriptConn=null;
            try {
              dependentScriptConn=rc.getResourceConnection(filename);
              currentCacheEntry.dependencies.put(dependentScriptConn.getURL(),new Long(dependentScriptConn.getLastModified()));
            }
 catch (            ResourceException e1) {
              throw new ClassNotFoundException("Could not read " + className + ": "+ e1);
            }
            InputStream inputStream=null;
            try {
              inputStream=dependentScriptConn.getInputStream();
              return parseClass(inputStream,filename);
            }
 catch (            CompilationFailedException e2) {
              throw new ClassNotFoundException("Syntax error in " + className + ": "+ e2);
            }
catch (            IOException e2) {
              throw new ClassNotFoundException("Problem reading " + className + ": "+ e2);
            }
 finally {
              if (inputStream != null) {
                try {
                  inputStream.close();
                }
 catch (                IOException e) {
                }
              }
            }
          }
        }
;
      }
    }
);
  }
}
