{
  if (ci.handle == null)   return;
  MethodHandle fallback=makeFallBack(ci.callSite,ci.sender,ci.methodName,ci.targetType);
  if (receiver == null) {
    MethodHandle test=IS_NULL.asType(MethodType.methodType(boolean.class,ci.targetType.parameterType(1)));
    test=MethodHandles.dropArguments(test,0,ci.targetType.parameterType(0));
    ci.handle=MethodHandles.guardWithTest(test,ci.handle,fallback);
  }
 else   if (receiver instanceof GroovyObject) {
    GroovyObject go=(GroovyObject)receiver;
    MetaClassImpl mc=(MetaClassImpl)go.getMetaClass();
    MethodHandle test=SAME_MC.bindTo(mc);
    test=test.asType(MethodType.methodType(boolean.class,ci.targetType.parameterType(1)));
    test=MethodHandles.dropArguments(test,0,ci.targetType.parameterType(0));
    ci.handle=MethodHandles.guardWithTest(test,ci.handle,fallback);
  }
 else {
    ConstantMetaClassVersioning mcv=DefaultMetaClassInfo.getCurrentConstantMetaClassVersioning();
    MethodHandle test=VALID_MC_VERSION.bindTo(mcv);
    ci.handle=MethodHandles.guardWithTest(test,ci.handle,fallback);
    test=IS_NOT_NULL.asType(MethodType.methodType(boolean.class,ci.targetType.parameterType(1)));
    test=MethodHandles.dropArguments(test,0,ci.targetType.parameterType(0));
    ci.handle=MethodHandles.guardWithTest(test,ci.handle,fallback);
  }
}
