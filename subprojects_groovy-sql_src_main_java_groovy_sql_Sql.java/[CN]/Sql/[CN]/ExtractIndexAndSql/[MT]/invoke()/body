{
  if (cacheNamedQueries && namedParamSqlCache.containsKey(sql)) {
    newSql=namedParamSqlCache.get(sql);
    indexPropList=namedParamIndexPropCache.get(sql);
  }
 else {
    indexPropList=new ArrayList<Tuple>();
    StringBuilder sb=new StringBuilder();
    StringBuilder currentChunk=new StringBuilder();
    char[] chars=sql.toCharArray();
    int i=0;
    boolean inString=false;
    while (i < chars.length) {
switch (chars[i]) {
case '\'':
        inString=!inString;
      if (inString) {
        sb.append(adaptForNamedParams(currentChunk.toString(),indexPropList));
        currentChunk=new StringBuilder();
        currentChunk.append(chars[i]);
      }
 else {
        currentChunk.append(chars[i]);
        sb.append(currentChunk);
        currentChunk=new StringBuilder();
      }
    break;
default :
  currentChunk.append(chars[i]);
}
i++;
}
if (inString) throw new IllegalStateException("Failed to process query. Unterminated ' character?");
sb.append(adaptForNamedParams(currentChunk.toString(),indexPropList));
newSql=sb.toString();
namedParamSqlCache.put(sql,newSql);
namedParamIndexPropCache.put(sql,indexPropList);
}
return this;
}
